# Flutterwave Payment Integration Setup Guide

## Overview
This guide will help you integrate Flutterwave payment processor into your Skyeface project for accepting quote payments.

## Files Created

### 1. Models
- **`app/Models/Payment.php`** - Payment model to track all transactions

### 2. Services
- **`app/Services/FlutterwaveService.php`** - Service class handling all Flutterwave API interactions

### 3. Controllers
- **`app/Http/Controllers/PaymentController.php`** - Controller for payment flow management

### 4. Migrations
- **`database/migrations/2024_01_11_000000_create_payments_table.php`** - Database table for payments

### 5. Views
- **`resources/views/payment/form.blade.php`** - Payment form page

- **`resources/views/payment/success.blade.php`** - Success page




















































































































































































































































- Handle sensitive data securely- Log all payment transactions- Keep Flutterwave SDK updated- Validate all webhook signatures- Use strong HTTPS connections- Never commit `.env` with real API keysðŸ”’ **Important:**## Security Notes- Dashboard: https://dashboard.flutterwave.com/- Email: support@flutterwave.com- Documentation: https://developer.flutterwave.com/For Flutterwave support:## Support```$quote->payments()->paginate(10);```phpView all payments for a quote:### Payment History```    ->send(new PaymentConfirmation($payment));Mail::to($payment->customer_email)```phpCreate a mailable for payment confirmations:### Email Notifications```    ->with('payment', $payment);return redirect()->route('custom.success.page')// In PaymentController```phpEdit the controller to redirect to custom pages:### Custom Success/Failed Pages## Advanced Configuration- Verify network request to Flutterwave API- Check Flutterwave API keys in `.env`- Ensure `transaction_id` is correct### Payment Not Verifying- Check Laravel logs for errors- Verify webhook events are selected in Flutterwave dashboard- Check webhook secret in `.env`- Ensure webhook URL is publicly accessible### Webhook Not Working- Check `database/migrations` table is created- Check `.env` has correct Flutterwave keys- Ensure quote has a `quoted_price`### Payment Not Creating## Troubleshooting- Use test phone numbers provided in Flutterwave documentation### Test Phone (Mobile Money)- **Expiry:** 09/32- **CVV:** 123- **Card:** 4242 4242 4242 4242You can use these test cards in Flutterwave sandbox:### Test Cards (Sandbox Mode)## Testing| POST | `/payment/webhook` | `payment.webhook` | Webhook handler || POST | `/payment/callback` | `payment.callback` | Flutterwave callback || GET | `/payment/failed` | `payment.failed` | Failed payment page || GET | `/payment/success/{payment}` | `payment.success` | Success page || POST | `/payment/{quote}` | `payment.create` | Create payment record || GET | `/payment/{quote}` | `payment.form` | Show payment form ||--------|-------|------|-------------|| Method | Route | Name | Description |## Routes```- created_at, updated_at- paid_at (timestamp)- response_data (JSON)- payment_method- customer_name- customer_email- reference (unique reference)- transaction_id (from Flutterwave)- status (pending|completed|failed|cancelled)- currency (string)- amount (decimal)- quote_id (foreign key)- id```### Payments Table## Database Structure```}    // Payment is verified - update recordsif ($verification['success'] && $verification['status'] === 'successful') {$verification = $flutterwave->verifyPayment($transactionId);$flutterwave = new FlutterwaveService();```php### Verify Payment```}    redirect($result['payment_link']);if ($result['success']) {);    description: 'Quote #123 Payment'    reference: 'QUOTE-123-ABC',    name: 'John Doe',    email: 'customer@example.com',    amount: 100.00,$result = $flutterwave->initializePayment($flutterwave = new FlutterwaveService();```php### Initiate Payment## Usage- Payment verification on callback- Secure API communication- SSL/HTTPS required- Webhook signature validation- CSRF protection on all forms### Security Features- And more depending on customer's location- USSD- Bank Transfers- Mobile Money (Ghana, Rwanda, Uganda, Kenya, Comoros)- Credit/Debit Cards (Visa, Mastercard, etc.)### Supported Payment Methods   - Customer receives confirmation email   - Quote status updated to "Accepted" if payment successful   - Payment record created/updated in database   - Redirected to success/failed page5. After payment:4. Redirected to Flutterwave secure checkout3. Enters/confirms payment details2. Redirected to payment form page1. Customer clicks "Make Payment" button on quote### Payment Flow## Features4. Add your webhook secret   - `Charge failed`   - `Charge completed`3. Select events:   ```   https://yourdomain.com/payment/webhook   ```2. Set Webhook URL to:1. Go to Flutterwave Dashboard â†’ Settings â†’ Webhooks### Step 6: Configure Webhook in Flutterwave```@endif    </a>        <i class="fa fa-credit-card mr-2"></i>Make Payment    <a href="{{ route('payment.form', $quote->id) }}" class="btn btn-success">@if($quote->quoted_price && !$quote->hasCompletedPayment())```bladeAdd this button to your quote view (wherever you want to offer payment):### Step 5: Add Payment Button to Quote Views```}    return $this->payments()->where('status', 'completed')->exists();{public function hasCompletedPayment()}    return $this->hasMany(Payment::class);{public function payments()```phpAdd relationship to the Quote model:### Step 4: Update Quote ModelThis will create the `payments` table to store payment records.```php artisan migrate```bash### Step 3: Run Migrations- Or any other Flutterwave supported currency- `NGN` - Nigerian Naira- `UGX` - Ugandan Shilling- `KES` - Kenyan Shilling- `ZAR` - South African Rand- `GHS` - Ghana Cedis**Note:** You can change `FLUTTERWAVE_CURRENCY` to:```FLUTTERWAVE_CURRENCY=USDFLUTTERWAVE_WEBHOOK_SECRET=your_webhook_secret_hereFLUTTERWAVE_SECRET_KEY=sk_your_secret_key_hereFLUTTERWAVE_PUBLIC_KEY=pk_your_public_key_here```envAdd these to your `.env` file:### Step 2: Update Environment Variables   - **Webhook Secret** (for webhooks)   - **Secret Key** (starts with `sk_`)   - **Public Key** (starts with `pk_`)4. Copy your:3. Navigate to **Settings** â†’ **API Keys**2. Sign up or log in1. Go to [Flutterwave Dashboard](https://dashboard.flutterwave.com/)### Step 1: Get Flutterwave Credentials## Setup Steps- Routes added to `routes/web.php`### 7. Routes- **`config/services.php`** - Updated with Flutterwave credentials### 6. Configuration- **`resources/views/payment/failed.blade.php`** - Failed payment page
